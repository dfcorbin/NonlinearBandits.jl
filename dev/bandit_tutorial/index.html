<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Bandits Tutorial · NonlinearBandits.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://dfcorbin.github.io/NonlinearBandits.jl/bandit_tutorial/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">NonlinearBandits.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><span class="tocitem">Tutorials</span><ul><li class="is-active"><a class="tocitem" href>Bandits Tutorial</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Constructing-a-driver"><span>Constructing a driver</span></a></li><li class="toplevel"><a class="tocitem" href="#Example:-PolynomialThompsonSampling"><span>Example: PolynomialThompsonSampling</span></a></li></ul></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../bandits_api/">Bandits</a></li><li><a class="tocitem" href="../model_api/">Models</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Bandits Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Bandits Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/dfcorbin/NonlinearBandits.jl/blob/master/docs/src/bandit_tutorial.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Bandits-Tutorial"><a class="docs-heading-anchor" href="#Bandits-Tutorial">Bandits Tutorial</a><a id="Bandits-Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Bandits-Tutorial" title="Permalink"></a></h1><h1 id="Constructing-a-driver"><a class="docs-heading-anchor" href="#Constructing-a-driver">Constructing a driver</a><a id="Constructing-a-driver-1"></a><a class="docs-heading-anchor-permalink" href="#Constructing-a-driver" title="Permalink"></a></h1><p>In order to run a contextual multi-armed bandit simulation, one must first construct an <a href="../bandits_api/#NonlinearBandits.AbstractDriver"><code>AbstractDriver</code></a>, which manages how the policy interacts with the environment. The simplest of the drivers is the <a href="../bandits_api/#NonlinearBandits.StandardDriver"><code>StandardDriver</code></a>, which simply passes a batch of contexts to the policy, recieves an array of actions and observes a batch of rewards.</p><p>To construct the driver, we must first define how the contexts and rewards are generated. This can be done using objects with parent classes <a href="../bandits_api/#NonlinearBandits.AbstractContextSampler"><code>AbstractContextSampler</code></a>/<a href="../bandits_api/#NonlinearBandits.AbstractRewardSampler"><code>AbstractRewardSampler</code></a>.</p><pre><code class="language-julia hljs">using NonlinearBandits

d = 2 # Number of features
limits = repeat([-1.0 1.0], d, 1)
mf = (x -&gt; -10.0, x -&gt; 10.0) # Expected reward

csampler = UniformContexts(limits)
rsampler = GaussianRewards(mf)

X = csampler(1)
println(&quot;Contexts: &quot;, X)
r = rsampler(X, [1]) # Choose action 1
println(&quot;Rewards: &quot;, r)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Contexts: [-0.42566723534997797; -0.0937077726122435;;]
Rewards: [-11.153580088860455;;]</code></pre><p>In the above code we have first defined a 2-dimensional context space, the lower/upper bounds  of each feature are given by the columns of <code>limits</code>. The context sampler of type <a href="../bandits_api/#NonlinearBandits.UniformContexts"><code>UniformContexts</code></a> samples contexts uniformly across the space. The reward sampler of type <a href="../bandits_api/#NonlinearBandits.GaussianRewards"><code>GaussianRewards</code></a> ouputs Gaussian rewards centered on the corresponding function within <code>mf</code>. Notice that, in this case, we have chosen reward functions that are independent of the contexts, but this need not, and often isn&#39;t, the case. We sample one context vector and pass it to the reward sampler, where we have manually chosen the first action. This outputs the observed reward.</p><p>To complete the driver, we need to supply an <a href="../bandits_api/#NonlinearBandits.AbstractPolicy"><code>AbstractPolicy</code></a> and an optional  tuple, with elements of type <a href="../bandits_api/#NonlinearBandits.AbstractMetric"><code>AbstractMetric</code></a>. For simplicity, we will construct a policy that chooses action at random. We can also compute the regret of each decision using the <a href="../bandits_api/#NonlinearBandits.FunctionalRegret"><code>FunctionalRegret</code></a> metric.</p><pre><code class="language-julia hljs">policy = RandomPolicy(d)
metrics = (FunctionalRegret(mf),)
driver = StandardDriver(csampler, policy, rsampler, metrics)
typeof(driver)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">StandardDriver{UniformContexts, GaussianRewards{Tuple{Main.var&quot;#1#3&quot;, Main.var&quot;#2#4&quot;}}, RandomPolicy, Tuple{FunctionalRegret{Tuple{Main.var&quot;#1#3&quot;, Main.var&quot;#2#4&quot;}}}}</code></pre><p>We can now output batches of observations from the driver.</p><pre><code class="language-julia hljs">batch_size = 5
X, a, r = driver(batch_size)
println(&quot;contexts: &quot;, X)
println(&quot;actions: &quot;, a)
println(&quot;rewards: &quot;, r)

regret = metrics[1].regret
println(&quot;regret: &quot;, regret)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">contexts: [-0.44423013743191264 0.2870978981177421 -0.20340601935225977 0.7628614868794781 0.1444833657806286; -0.9220531404044192 0.9134999986682779 0.9533483967916816 -0.8406769051956695 -0.6998177899853655]
actions: [1, 1, 1, 2, 1]
rewards: [-9.328887631043802 -9.903817418484595 -10.863686595318143 9.896804883935518 -9.164898478464643]
regret: [20.0, 20.0, 20.0, 0.0, 20.0]</code></pre><p>Notice that regret is only non-zero when the second action is chosen. With the driver constructed, we can finally run a batched simulation, where the policy is update (via <a href="../bandits_api/#NonlinearBandits.update!"><code>update!</code></a>) after each batch.</p><pre><code class="language- hljs">using Plots
theme(:ggplot2)

num_batches = 10
run!(num_batches, batch_size, driver)

regret = metrics[1].regret
plot(regret, legend=nothing, ylab=&quot;regret&quot;, xlab=&quot;timestep&quot;)</code></pre><p>There have been a total of 55 timesteps, since the driver has been called 11 times with a batch size of 5 (including the call in the previous code block). The regret is purely random over the course of the trajectory, since we always choose actions randomly.</p><h1 id="Example:-PolynomialThompsonSampling"><a class="docs-heading-anchor" href="#Example:-PolynomialThompsonSampling">Example: PolynomialThompsonSampling</a><a id="Example:-PolynomialThompsonSampling-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-PolynomialThompsonSampling" title="Permalink"></a></h1><p>To see demonstrate the learning process of a bandit agent, we use the <a href="../bandits_api/#NonlinearBandits.PolynomialThompsonSampling"><code>PolynomialThompsonSampling</code></a> policy. First construct the driver:</p><pre><code class="language-julia hljs">using NonlinearBandits, Plots, Colors
theme(:ggplot2)

d = 1
limits = repeat([-1.0 1.0], d, 1)
mf = (
    x -&gt; 10 * sin(5^(2 * x[1]) * x[1]),
    x -&gt; x[1]^3 - 3 * x[1]^2 + 4 * x[1]
)


xplt = -1.0:0.01:1.0
cls = distinguishable_colors(length(mf), RGB(0, 128/256, 128/256))
mf_plot = plot(legend=:topleft)
for i in 1:length(mf)
    plot!(xplt, x -&gt; mf[i]([x]), label=&quot;Arm $i&quot;, color=cls[i], xlab=&quot;x&quot;, ylab=&quot;Expected Reward&quot;)
end
plot(mf_plot) # Display the reward functions</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip030">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip030)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip031">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip030)" d="
M102.74 1505.26 L2352.76 1505.26 L2352.76 47.2441 L102.74 47.2441  Z
  " fill="#eaeaea" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip032">
    <rect x="102" y="47" width="2251" height="1459"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  166.42,1505.26 166.42,47.2441 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  697.084,1505.26 697.084,47.2441 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1227.75,1505.26 1227.75,47.2441 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1758.41,1505.26 1758.41,47.2441 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2289.08,1505.26 2289.08,47.2441 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:1; fill:none" points="
  431.752,1505.26 431.752,47.2441 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:1; fill:none" points="
  962.416,1505.26 962.416,47.2441 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:1; fill:none" points="
  1493.08,1505.26 1493.08,47.2441 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:1; fill:none" points="
  2023.74,1505.26 2023.74,47.2441 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,1505.26 2352.76,1505.26 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  166.42,1505.26 166.42,1524.16 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  697.084,1505.26 697.084,1524.16 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1227.75,1505.26 1227.75,1524.16 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1758.41,1505.26 1758.41,1524.16 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2289.08,1505.26 2289.08,1524.16 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  431.752,1505.26 431.752,1514.71 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  962.416,1505.26 962.416,1514.71 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1493.08,1505.26 1493.08,1514.71 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2023.74,1505.26 2023.74,1514.71 
  "/>
<path clip-path="url(#clip030)" d="M112.948 1560.43 L142.624 1560.43 L142.624 1564.37 L112.948 1564.37 L112.948 1560.43 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M153.526 1573.32 L161.165 1573.32 L161.165 1546.96 L152.855 1548.63 L152.855 1544.37 L161.119 1542.7 L165.795 1542.7 L165.795 1573.32 L173.434 1573.32 L173.434 1577.26 L153.526 1577.26 L153.526 1573.32 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M182.878 1571.38 L187.762 1571.38 L187.762 1577.26 L182.878 1577.26 L182.878 1571.38 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M207.947 1545.78 Q204.336 1545.78 202.508 1549.34 Q200.702 1552.88 200.702 1560.01 Q200.702 1567.12 202.508 1570.69 Q204.336 1574.23 207.947 1574.23 Q211.582 1574.23 213.387 1570.69 Q215.216 1567.12 215.216 1560.01 Q215.216 1552.88 213.387 1549.34 Q211.582 1545.78 207.947 1545.78 M207.947 1542.07 Q213.758 1542.07 216.813 1546.68 Q219.892 1551.26 219.892 1560.01 Q219.892 1568.74 216.813 1573.35 Q213.758 1577.93 207.947 1577.93 Q202.137 1577.93 199.059 1573.35 Q196.003 1568.74 196.003 1560.01 Q196.003 1551.26 199.059 1546.68 Q202.137 1542.07 207.947 1542.07 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M644.11 1560.43 L673.785 1560.43 L673.785 1564.37 L644.11 1564.37 L644.11 1560.43 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M693.878 1545.78 Q690.267 1545.78 688.438 1549.34 Q686.633 1552.88 686.633 1560.01 Q686.633 1567.12 688.438 1570.69 Q690.267 1574.23 693.878 1574.23 Q697.512 1574.23 699.318 1570.69 Q701.146 1567.12 701.146 1560.01 Q701.146 1552.88 699.318 1549.34 Q697.512 1545.78 693.878 1545.78 M693.878 1542.07 Q699.688 1542.07 702.744 1546.68 Q705.822 1551.26 705.822 1560.01 Q705.822 1568.74 702.744 1573.35 Q699.688 1577.93 693.878 1577.93 Q688.068 1577.93 684.989 1573.35 Q681.934 1568.74 681.934 1560.01 Q681.934 1551.26 684.989 1546.68 Q688.068 1542.07 693.878 1542.07 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M714.04 1571.38 L718.924 1571.38 L718.924 1577.26 L714.04 1577.26 L714.04 1571.38 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M729.156 1542.7 L747.512 1542.7 L747.512 1546.64 L733.438 1546.64 L733.438 1555.11 Q734.456 1554.76 735.475 1554.6 Q736.493 1554.41 737.512 1554.41 Q743.299 1554.41 746.679 1557.58 Q750.058 1560.76 750.058 1566.17 Q750.058 1571.75 746.586 1574.85 Q743.114 1577.93 736.794 1577.93 Q734.618 1577.93 732.35 1577.56 Q730.105 1577.19 727.697 1576.45 L727.697 1571.75 Q729.781 1572.88 732.003 1573.44 Q734.225 1574 736.702 1574 Q740.706 1574 743.044 1571.89 Q745.382 1569.78 745.382 1566.17 Q745.382 1562.56 743.044 1560.45 Q740.706 1558.35 736.702 1558.35 Q734.827 1558.35 732.952 1558.76 Q731.1 1559.18 729.156 1560.06 L729.156 1542.7 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M1205.13 1545.78 Q1201.52 1545.78 1199.69 1549.34 Q1197.89 1552.88 1197.89 1560.01 Q1197.89 1567.12 1199.69 1570.69 Q1201.52 1574.23 1205.13 1574.23 Q1208.77 1574.23 1210.57 1570.69 Q1212.4 1567.12 1212.4 1560.01 Q1212.4 1552.88 1210.57 1549.34 Q1208.77 1545.78 1205.13 1545.78 M1205.13 1542.07 Q1210.94 1542.07 1214 1546.68 Q1217.08 1551.26 1217.08 1560.01 Q1217.08 1568.74 1214 1573.35 Q1210.94 1577.93 1205.13 1577.93 Q1199.32 1577.93 1196.24 1573.35 Q1193.19 1568.74 1193.19 1560.01 Q1193.19 1551.26 1196.24 1546.68 Q1199.32 1542.07 1205.13 1542.07 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M1225.29 1571.38 L1230.18 1571.38 L1230.18 1577.26 L1225.29 1577.26 L1225.29 1571.38 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M1250.36 1545.78 Q1246.75 1545.78 1244.92 1549.34 Q1243.12 1552.88 1243.12 1560.01 Q1243.12 1567.12 1244.92 1570.69 Q1246.75 1574.23 1250.36 1574.23 Q1254 1574.23 1255.8 1570.69 Q1257.63 1567.12 1257.63 1560.01 Q1257.63 1552.88 1255.8 1549.34 Q1254 1545.78 1250.36 1545.78 M1250.36 1542.07 Q1256.17 1542.07 1259.23 1546.68 Q1262.31 1551.26 1262.31 1560.01 Q1262.31 1568.74 1259.23 1573.35 Q1256.17 1577.93 1250.36 1577.93 Q1244.55 1577.93 1241.47 1573.35 Q1238.42 1568.74 1238.42 1560.01 Q1238.42 1551.26 1241.47 1546.68 Q1244.55 1542.07 1250.36 1542.07 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M1736.29 1545.78 Q1732.68 1545.78 1730.85 1549.34 Q1729.05 1552.88 1729.05 1560.01 Q1729.05 1567.12 1730.85 1570.69 Q1732.68 1574.23 1736.29 1574.23 Q1739.93 1574.23 1741.73 1570.69 Q1743.56 1567.12 1743.56 1560.01 Q1743.56 1552.88 1741.73 1549.34 Q1739.93 1545.78 1736.29 1545.78 M1736.29 1542.07 Q1742.1 1542.07 1745.16 1546.68 Q1748.24 1551.26 1748.24 1560.01 Q1748.24 1568.74 1745.16 1573.35 Q1742.1 1577.93 1736.29 1577.93 Q1730.48 1577.93 1727.41 1573.35 Q1724.35 1568.74 1724.35 1560.01 Q1724.35 1551.26 1727.41 1546.68 Q1730.48 1542.07 1736.29 1542.07 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M1756.46 1571.38 L1761.34 1571.38 L1761.34 1577.26 L1756.46 1577.26 L1756.46 1571.38 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M1771.57 1542.7 L1789.93 1542.7 L1789.93 1546.64 L1775.85 1546.64 L1775.85 1555.11 Q1776.87 1554.76 1777.89 1554.6 Q1778.91 1554.41 1779.93 1554.41 Q1785.72 1554.41 1789.09 1557.58 Q1792.47 1560.76 1792.47 1566.17 Q1792.47 1571.75 1789 1574.85 Q1785.53 1577.93 1779.21 1577.93 Q1777.03 1577.93 1774.77 1577.56 Q1772.52 1577.19 1770.11 1576.45 L1770.11 1571.75 Q1772.2 1572.88 1774.42 1573.44 Q1776.64 1574 1779.12 1574 Q1783.12 1574 1785.46 1571.89 Q1787.8 1569.78 1787.8 1566.17 Q1787.8 1562.56 1785.46 1560.45 Q1783.12 1558.35 1779.12 1558.35 Q1777.24 1558.35 1775.37 1558.76 Q1773.52 1559.18 1771.57 1560.06 L1771.57 1542.7 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M2256.23 1573.32 L2263.87 1573.32 L2263.87 1546.96 L2255.56 1548.63 L2255.56 1544.37 L2263.82 1542.7 L2268.5 1542.7 L2268.5 1573.32 L2276.14 1573.32 L2276.14 1577.26 L2256.23 1577.26 L2256.23 1573.32 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M2285.58 1571.38 L2290.47 1571.38 L2290.47 1577.26 L2285.58 1577.26 L2285.58 1571.38 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M2310.65 1545.78 Q2307.04 1545.78 2305.21 1549.34 Q2303.4 1552.88 2303.4 1560.01 Q2303.4 1567.12 2305.21 1570.69 Q2307.04 1574.23 2310.65 1574.23 Q2314.28 1574.23 2316.09 1570.69 Q2317.92 1567.12 2317.92 1560.01 Q2317.92 1552.88 2316.09 1549.34 Q2314.28 1545.78 2310.65 1545.78 M2310.65 1542.07 Q2316.46 1542.07 2319.52 1546.68 Q2322.59 1551.26 2322.59 1560.01 Q2322.59 1568.74 2319.52 1573.35 Q2316.46 1577.93 2310.65 1577.93 Q2304.84 1577.93 2301.76 1573.35 Q2298.71 1568.74 2298.71 1560.01 Q2298.71 1551.26 2301.76 1546.68 Q2304.84 1542.07 2310.65 1542.07 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M1244.36 1614.48 L1231.47 1631.82 L1245.03 1650.12 L1238.12 1650.12 L1227.75 1636.12 L1217.37 1650.12 L1210.47 1650.12 L1224.31 1631.47 L1211.64 1614.48 L1218.55 1614.48 L1228 1627.18 L1237.46 1614.48 L1244.36 1614.48 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,1464.03 2352.76,1464.03 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,1120.04 2352.76,1120.04 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,776.042 2352.76,776.042 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,432.048 2352.76,432.048 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,88.0531 2352.76,88.0531 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:1; fill:none" points="
  102.74,1292.03 2352.76,1292.03 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:1; fill:none" points="
  102.74,948.039 2352.76,948.039 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:1; fill:none" points="
  102.74,604.045 2352.76,604.045 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:2; stroke-opacity:1; fill:none" points="
  102.74,260.05 2352.76,260.05 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,1505.26 102.74,47.2441 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,1464.03 83.8425,1464.03 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,1120.04 83.8425,1120.04 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,776.042 83.8425,776.042 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,432.048 83.8425,432.048 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,88.0531 83.8425,88.0531 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,1292.03 93.2913,1292.03 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,948.039 93.2913,948.039 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,604.045 93.2913,604.045 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#333333; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  102.74,260.05 93.2913,260.05 
  "/>
<path clip-path="url(#clip030)" d="M-43.1344 1464.48 L-13.4586 1464.48 L-13.4586 1468.42 L-43.1344 1468.42 L-43.1344 1464.48 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-2.55586 1477.38 L5.08298 1477.38 L5.08298 1451.01 L-3.22716 1452.68 L-3.22716 1448.42 L5.03669 1446.75 L9.71259 1446.75 L9.71259 1477.38 L17.3514 1477.38 L17.3514 1481.31 L-2.55586 1481.31 L-2.55586 1477.38 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M36.7958 1449.83 Q33.1847 1449.83 31.356 1453.39 Q29.5504 1456.94 29.5504 1464.07 Q29.5504 1471.17 31.356 1474.74 Q33.1847 1478.28 36.7958 1478.28 Q40.43 1478.28 42.2356 1474.74 Q44.0643 1471.17 44.0643 1464.07 Q44.0643 1456.94 42.2356 1453.39 Q40.43 1449.83 36.7958 1449.83 M36.7958 1446.13 Q42.6059 1446.13 45.6615 1450.73 Q48.7402 1455.32 48.7402 1464.07 Q48.7402 1472.79 45.6615 1477.4 Q42.6059 1481.98 36.7958 1481.98 Q30.9856 1481.98 27.9069 1477.4 Q24.8514 1472.79 24.8514 1464.07 Q24.8514 1455.32 27.9069 1450.73 Q30.9856 1446.13 36.7958 1446.13 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-11.9771 1120.49 L17.6987 1120.49 L17.6987 1124.42 L-11.9771 1124.42 L-11.9771 1120.49 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M27.8375 1102.76 L46.1939 1102.76 L46.1939 1106.69 L32.1199 1106.69 L32.1199 1115.16 Q33.1384 1114.82 34.1569 1114.65 Q35.1754 1114.47 36.1939 1114.47 Q41.9809 1114.47 45.3605 1117.64 Q48.7402 1120.81 48.7402 1126.23 Q48.7402 1131.81 45.268 1134.91 Q41.7958 1137.99 35.4763 1137.99 Q33.3004 1137.99 31.0319 1137.62 Q28.7866 1137.25 26.3792 1136.51 L26.3792 1131.81 Q28.4625 1132.94 30.6847 1133.5 Q32.9069 1134.05 35.3837 1134.05 Q39.3884 1134.05 41.7263 1131.95 Q44.0643 1129.84 44.0643 1126.23 Q44.0643 1122.62 41.7263 1120.51 Q39.3884 1118.4 35.3837 1118.4 Q33.5088 1118.4 31.6338 1118.82 Q29.7819 1119.24 27.8375 1120.12 L27.8375 1102.76 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M36.7958 761.841 Q33.1847 761.841 31.356 765.405 Q29.5504 768.947 29.5504 776.077 Q29.5504 783.183 31.356 786.748 Q33.1847 790.29 36.7958 790.29 Q40.43 790.29 42.2356 786.748 Q44.0643 783.183 44.0643 776.077 Q44.0643 768.947 42.2356 765.405 Q40.43 761.841 36.7958 761.841 M36.7958 758.137 Q42.6059 758.137 45.6615 762.743 Q48.7402 767.327 48.7402 776.077 Q48.7402 784.803 45.6615 789.41 Q42.6059 793.993 36.7958 793.993 Q30.9856 793.993 27.9069 789.41 Q24.8514 784.803 24.8514 776.077 Q24.8514 767.327 27.9069 762.743 Q30.9856 758.137 36.7958 758.137 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M27.8375 414.768 L46.1939 414.768 L46.1939 418.703 L32.1199 418.703 L32.1199 427.175 Q33.1384 426.828 34.1569 426.666 Q35.1754 426.48 36.1939 426.48 Q41.9809 426.48 45.3605 429.652 Q48.7402 432.823 48.7402 438.24 Q48.7402 443.818 45.268 446.92 Q41.7958 449.999 35.4763 449.999 Q33.3004 449.999 31.0319 449.628 Q28.7866 449.258 26.3792 448.517 L26.3792 443.818 Q28.4625 444.953 30.6847 445.508 Q32.9069 446.064 35.3837 446.064 Q39.3884 446.064 41.7263 443.957 Q44.0643 441.851 44.0643 438.24 Q44.0643 434.629 41.7263 432.522 Q39.3884 430.416 35.3837 430.416 Q33.5088 430.416 31.6338 430.832 Q29.7819 431.249 27.8375 432.129 L27.8375 414.768 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-2.55586 101.398 L5.08298 101.398 L5.08298 75.0324 L-3.22716 76.699 L-3.22716 72.4398 L5.03669 70.7731 L9.71259 70.7731 L9.71259 101.398 L17.3514 101.398 L17.3514 105.333 L-2.55586 105.333 L-2.55586 101.398 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M36.7958 73.8518 Q33.1847 73.8518 31.356 77.4166 Q29.5504 80.9582 29.5504 88.0878 Q29.5504 95.1943 31.356 98.7591 Q33.1847 102.301 36.7958 102.301 Q40.43 102.301 42.2356 98.7591 Q44.0643 95.1943 44.0643 88.0878 Q44.0643 80.9582 42.2356 77.4166 Q40.43 73.8518 36.7958 73.8518 M36.7958 70.1481 Q42.6059 70.1481 45.6615 74.7546 Q48.7402 79.3379 48.7402 88.0878 Q48.7402 96.8146 45.6615 101.421 Q42.6059 106.004 36.7958 106.004 Q30.9856 106.004 27.9069 101.421 Q24.8514 96.8146 24.8514 88.0878 Q24.8514 79.3379 27.9069 74.7546 Q30.9856 70.1481 36.7958 70.1481 Z" fill="#4c4c4c" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-122.91 1053.89 L-122.91 1023.85 L-117.499 1023.85 L-117.499 1047.46 L-103.431 1047.46 L-103.431 1024.83 L-98.0204 1024.83 L-98.0204 1047.46 L-80.8012 1047.46 L-80.8012 1023.27 L-75.3904 1023.27 L-75.3904 1053.89 L-122.91 1053.89 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-111.038 983.328 L-93.6918 996.219 L-75.3904 982.66 L-75.3904 989.567 L-89.3949 999.943 L-75.3904 1010.32 L-75.3904 1017.23 L-94.0419 1003.38 L-111.038 1016.05 L-111.038 1009.14 L-98.3387 999.688 L-111.038 990.235 L-111.038 983.328 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-80.7375 968.719 L-61.8314 968.719 L-61.8314 974.607 L-111.038 974.607 L-111.038 968.719 L-105.627 968.719 Q-108.81 966.873 -110.338 964.072 Q-111.898 961.239 -111.898 957.324 Q-111.898 950.831 -106.741 946.789 Q-101.585 942.715 -93.1825 942.715 Q-84.7798 942.715 -79.6235 946.789 Q-74.4673 950.831 -74.4673 957.324 Q-74.4673 961.239 -75.9951 964.072 Q-77.5547 966.873 -80.7375 968.719 M-93.1825 948.794 Q-99.6437 948.794 -103.304 951.468 Q-106.996 954.11 -106.996 958.757 Q-106.996 963.404 -103.304 966.077 Q-99.6437 968.719 -93.1825 968.719 Q-86.7213 968.719 -83.0292 966.077 Q-79.3689 963.404 -79.3689 958.757 Q-79.3689 954.11 -83.0292 951.468 Q-86.7213 948.794 -93.1825 948.794 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-94.6784 902.516 L-91.8139 902.516 L-91.8139 929.443 Q-85.7665 929.061 -82.5836 925.814 Q-79.4326 922.536 -79.4326 916.711 Q-79.4326 913.337 -80.2601 910.186 Q-81.0877 907.004 -82.7427 903.884 L-77.2046 903.884 Q-75.8678 907.035 -75.1676 910.346 Q-74.4673 913.656 -74.4673 917.061 Q-74.4673 925.591 -79.4326 930.589 Q-84.3978 935.554 -92.8642 935.554 Q-101.617 935.554 -106.741 930.843 Q-111.898 926.101 -111.898 918.08 Q-111.898 910.887 -107.251 906.717 Q-102.636 902.516 -94.6784 902.516 M-96.3972 908.372 Q-101.203 908.436 -104.068 911.078 Q-106.932 913.688 -106.932 918.016 Q-106.932 922.918 -104.163 925.878 Q-101.394 928.806 -96.3654 929.252 L-96.3972 908.372 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-109.67 867.25 L-104.195 867.25 Q-105.564 869.732 -106.232 872.247 Q-106.932 874.729 -106.932 877.276 Q-106.932 882.973 -103.304 886.124 Q-99.7073 889.275 -93.1825 889.275 Q-86.6577 889.275 -83.0292 886.124 Q-79.4326 882.973 -79.4326 877.276 Q-79.4326 874.729 -80.101 872.247 Q-80.8012 869.732 -82.1698 867.25 L-76.759 867.25 Q-75.6131 869.701 -75.0402 872.342 Q-74.4673 874.952 -74.4673 877.912 Q-74.4673 885.965 -79.5281 890.707 Q-84.5888 895.45 -93.1825 895.45 Q-101.904 895.45 -106.901 890.676 Q-111.898 885.869 -111.898 877.53 Q-111.898 874.825 -111.325 872.247 Q-110.784 869.669 -109.67 867.25 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-121.16 851.272 L-111.038 851.272 L-111.038 839.209 L-106.487 839.209 L-106.487 851.272 L-87.1351 851.272 Q-82.7746 851.272 -81.5333 850.094 Q-80.2919 848.885 -80.2919 845.224 L-80.2919 839.209 L-75.3904 839.209 L-75.3904 845.224 Q-75.3904 852.004 -77.9048 854.582 Q-80.4511 857.16 -87.1351 857.16 L-106.487 857.16 L-106.487 861.457 L-111.038 861.457 L-111.038 857.16 L-121.16 857.16 L-121.16 851.272 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-94.6784 801.015 L-91.8139 801.015 L-91.8139 827.942 Q-85.7665 827.56 -82.5836 824.313 Q-79.4326 821.035 -79.4326 815.21 Q-79.4326 811.836 -80.2601 808.685 Q-81.0877 805.502 -82.7427 802.383 L-77.2046 802.383 Q-75.8678 805.534 -75.1676 808.844 Q-74.4673 812.155 -74.4673 815.56 Q-74.4673 824.09 -79.4326 829.087 Q-84.3978 834.053 -92.8642 834.053 Q-101.617 834.053 -106.741 829.342 Q-111.898 824.6 -111.898 816.579 Q-111.898 809.385 -107.251 805.216 Q-102.636 801.015 -94.6784 801.015 M-96.3972 806.871 Q-101.203 806.935 -104.068 809.576 Q-106.932 812.186 -106.932 816.515 Q-106.932 821.417 -104.163 824.377 Q-101.394 827.305 -96.3654 827.751 L-96.3972 806.871 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-105.627 767.945 L-124.916 767.945 L-124.916 762.088 L-75.3904 762.088 L-75.3904 767.945 L-80.7375 767.945 Q-77.5547 769.791 -75.9951 772.624 Q-74.4673 775.424 -74.4673 779.371 Q-74.4673 785.832 -79.6235 789.906 Q-84.7798 793.949 -93.1825 793.949 Q-101.585 793.949 -106.741 789.906 Q-111.898 785.832 -111.898 779.371 Q-111.898 775.424 -110.338 772.624 Q-108.81 769.791 -105.627 767.945 M-93.1825 787.901 Q-86.7213 787.901 -83.0292 785.259 Q-79.3689 782.586 -79.3689 777.939 Q-79.3689 773.292 -83.0292 770.618 Q-86.7213 767.945 -93.1825 767.945 Q-99.6437 767.945 -103.304 770.618 Q-106.996 773.292 -106.996 777.939 Q-106.996 782.586 -103.304 785.259 Q-99.6437 787.901 -93.1825 787.901 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-97.6703 706.516 Q-96.9701 704.447 -94.6784 702.505 Q-92.3868 700.532 -88.3764 698.559 L-75.3904 692.034 L-75.3904 698.94 L-87.5807 705.02 Q-92.355 707.375 -93.9146 709.603 Q-95.4742 711.799 -95.4742 715.619 L-95.4742 722.621 L-75.3904 722.621 L-75.3904 729.05 L-122.91 729.05 L-122.91 714.536 Q-122.91 706.388 -119.505 702.378 Q-116.099 698.368 -109.224 698.368 Q-104.736 698.368 -101.776 700.468 Q-98.8162 702.537 -97.6703 706.516 M-117.627 722.621 L-100.758 722.621 L-100.758 714.536 Q-100.758 709.889 -102.89 707.534 Q-105.055 705.147 -109.224 705.147 Q-113.394 705.147 -115.494 707.534 Q-117.627 709.889 -117.627 714.536 L-117.627 722.621 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-94.6784 656.449 L-91.8139 656.449 L-91.8139 683.376 Q-85.7665 682.994 -82.5836 679.748 Q-79.4326 676.47 -79.4326 670.645 Q-79.4326 667.271 -80.2601 664.12 Q-81.0877 660.937 -82.7427 657.818 L-77.2046 657.818 Q-75.8678 660.969 -75.1676 664.279 Q-74.4673 667.589 -74.4673 670.995 Q-74.4673 679.525 -79.4326 684.522 Q-84.3978 689.487 -92.8642 689.487 Q-101.617 689.487 -106.741 684.777 Q-111.898 680.034 -111.898 672.014 Q-111.898 664.82 -107.251 660.651 Q-102.636 656.449 -94.6784 656.449 M-96.3972 662.306 Q-101.203 662.369 -104.068 665.011 Q-106.932 667.621 -106.932 671.95 Q-106.932 676.851 -104.163 679.812 Q-101.394 682.74 -96.3654 683.185 L-96.3972 662.306 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-111.038 650.243 L-111.038 644.386 L-83.2202 637.066 L-111.038 629.777 L-111.038 622.87 L-83.2202 615.55 L-111.038 608.261 L-111.038 602.405 L-75.3904 611.73 L-75.3904 618.637 L-104.609 626.308 L-75.3904 634.01 L-75.3904 640.917 L-111.038 650.243 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-93.3098 577.324 Q-93.3098 584.421 -91.6866 587.159 Q-90.0633 589.896 -86.1484 589.896 Q-83.0292 589.896 -81.1831 587.859 Q-79.3689 585.79 -79.3689 582.257 Q-79.3689 577.387 -82.8064 574.459 Q-86.2757 571.499 -92.0048 571.499 L-93.3098 571.499 L-93.3098 577.324 M-95.7288 565.643 L-75.3904 565.643 L-75.3904 571.499 L-80.8012 571.499 Q-77.5547 573.504 -75.9951 576.496 Q-74.4673 579.488 -74.4673 583.817 Q-74.4673 589.291 -77.5229 592.538 Q-80.6102 595.752 -85.7665 595.752 Q-91.782 595.752 -94.8376 591.742 Q-97.8931 587.7 -97.8931 579.711 L-97.8931 571.499 L-98.466 571.499 Q-102.508 571.499 -104.704 574.173 Q-106.932 576.814 -106.932 581.62 Q-106.932 584.676 -106.2 587.572 Q-105.468 590.469 -104.004 593.142 L-109.415 593.142 Q-110.656 589.928 -111.261 586.904 Q-111.898 583.88 -111.898 581.016 Q-111.898 573.281 -107.887 569.462 Q-103.877 565.643 -95.7288 565.643 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-105.564 532.923 Q-106.137 533.91 -106.391 535.087 Q-106.678 536.233 -106.678 537.633 Q-106.678 542.599 -103.431 545.272 Q-100.217 547.914 -94.1692 547.914 L-75.3904 547.914 L-75.3904 553.802 L-111.038 553.802 L-111.038 547.914 L-105.5 547.914 Q-108.747 546.068 -110.306 543.108 Q-111.898 540.148 -111.898 535.915 Q-111.898 535.31 -111.802 534.578 Q-111.739 533.846 -111.579 532.955 L-105.564 532.923 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M-105.627 504.468 L-124.916 504.468 L-124.916 498.612 L-75.3904 498.612 L-75.3904 504.468 L-80.7375 504.468 Q-77.5547 506.314 -75.9951 509.147 Q-74.4673 511.948 -74.4673 515.895 Q-74.4673 522.356 -79.6235 526.43 Q-84.7798 530.472 -93.1825 530.472 Q-101.585 530.472 -106.741 526.43 Q-111.898 522.356 -111.898 515.895 Q-111.898 511.948 -110.338 509.147 Q-108.81 506.314 -105.627 504.468 M-93.1825 524.425 Q-86.7213 524.425 -83.0292 521.783 Q-79.3689 519.109 -79.3689 514.462 Q-79.3689 509.815 -83.0292 507.142 Q-86.7213 504.468 -93.1825 504.468 Q-99.6437 504.468 -103.304 507.142 Q-106.996 509.815 -106.996 514.462 Q-106.996 519.109 -103.304 521.783 Q-99.6437 524.425 -93.1825 524.425 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip032)" style="stroke:#007f7f; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  166.42,803.554 177.033,804.17 187.646,804.796 198.26,805.433 208.873,806.081 219.486,806.74 230.1,807.411 240.713,808.092 251.326,808.784 261.939,809.487 
  272.553,810.2 283.166,810.925 293.779,811.661 304.393,812.408 315.006,813.165 325.619,813.933 336.232,814.711 346.846,815.5 357.459,816.298 368.072,817.107 
  378.685,817.926 389.299,818.755 399.912,819.592 410.525,820.439 421.139,821.295 431.752,822.159 442.365,823.031 452.978,823.911 463.592,824.798 474.205,825.693 
  484.818,826.593 495.432,827.499 506.045,828.411 516.658,829.326 527.271,830.246 537.885,831.169 548.498,832.095 559.111,833.022 569.725,833.95 580.338,834.877 
  590.951,835.803 601.564,836.727 612.178,837.648 622.791,838.564 633.404,839.474 644.018,840.376 654.631,841.27 665.244,842.154 675.857,843.025 686.471,843.883 
  697.084,844.726 707.697,845.552 718.311,846.358 728.924,847.142 739.537,847.903 750.15,848.638 760.764,849.344 771.377,850.019 781.99,850.659 792.603,851.263 
  803.217,851.827 813.83,852.347 824.443,852.821 835.057,853.244 845.67,853.613 856.283,853.924 866.896,854.173 877.51,854.355 888.123,854.465 898.736,854.5 
  909.35,854.453 919.963,854.319 930.576,854.093 941.189,853.769 951.803,853.341 962.416,852.801 973.029,852.144 983.643,851.362 994.256,850.448 1004.87,849.393 
  1015.48,848.19 1026.1,846.83 1036.71,845.303 1047.32,843.6 1057.94,841.712 1068.55,839.628 1079.16,837.336 1089.78,834.826 1100.39,832.086 1111,829.102 
  1121.62,825.862 1132.23,822.353 1142.84,818.559 1153.46,814.465 1164.07,810.058 1174.68,805.319 1185.29,800.232 1195.91,794.779 1206.52,788.943 1217.13,782.704 
  1227.75,776.042 1238.36,768.937 1248.97,761.368 1259.59,753.314 1270.2,744.752 1280.81,735.659 1291.43,726.013 1302.04,715.789 1312.65,704.965 1323.27,693.516 
  1333.88,681.419 1344.49,668.651 1355.11,655.189 1365.72,641.012 1376.33,626.101 1386.95,610.435 1397.56,594.001 1408.17,576.785 1418.79,558.779 1429.4,539.979 
  1440.01,520.386 1450.63,500.009 1461.24,478.866 1471.85,456.983 1482.47,434.399 1493.08,411.165 1503.69,387.349 1514.31,363.038 1524.92,338.337 1535.53,313.378 
  1546.15,288.316 1556.76,263.342 1567.37,238.675 1577.99,214.575 1588.6,191.344 1599.21,169.327 1609.83,148.918 1620.44,130.565 1631.05,114.766 1641.67,102.076 
  1652.28,93.1031 1662.89,88.5087 1673.51,88.9992 1684.12,95.3189 1694.73,108.237 1705.35,128.527 1715.96,156.946 1726.57,194.197 1737.19,240.893 1747.8,297.504 
  1758.41,364.3 1769.03,441.277 1779.64,528.085 1790.25,623.937 1800.87,727.523 1811.48,836.924 1822.09,949.537 1832.71,1062.01 1843.32,1170.25 1853.93,1269.42 
  1864.54,1354.07 1875.16,1418.33 1885.77,1456.22 1896.38,1462.13 1907,1431.36 1917.61,1360.86 1928.22,1250.05 1938.84,1101.63 1949.45,922.36 1960.06,723.542 
  1970.68,521.106 1981.29,335.012 1991.9,187.769 2002.52,101.932 2013.13,96.5577 2023.74,182.884 2034.36,359.812 2044.97,610.187 2055.58,899.219 2066.2,1176.56 
  2076.81,1383.25 2087.42,1464 2098.04,1383.32 2108.65,1142.19 2119.26,789.189 2129.88,419.024 2140.49,152.697 2151.1,98.6468 2161.72,303.582 2172.33,712.537 
  2182.94,1164.27 2193.56,1442.53 2204.17,1379.93 2214.78,972.786 2225.4,432.284 2236.01,101.908 2246.62,241.163 2257.24,794.362 2267.85,1347.91 2278.46,1408.63 
  2289.08,867.098 
  "/>
<polyline clip-path="url(#clip032)" style="stroke:#fe005d; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  166.42,1326.43 177.033,1317.53 187.646,1308.71 198.26,1299.97 208.873,1291.31 219.486,1282.74 230.1,1274.24 240.713,1265.83 251.326,1257.49 261.939,1249.23 
  272.553,1241.05 283.166,1232.95 293.779,1224.93 304.393,1216.99 315.006,1209.12 325.619,1201.33 336.232,1193.62 346.846,1185.98 357.459,1178.42 368.072,1170.93 
  378.685,1163.52 389.299,1156.18 399.912,1148.91 410.525,1141.72 421.139,1134.61 431.752,1127.56 442.365,1120.59 452.978,1113.69 463.592,1106.86 474.205,1100.1 
  484.818,1093.41 495.432,1086.79 506.045,1080.25 516.658,1073.77 527.271,1067.36 537.885,1061.02 548.498,1054.74 559.111,1048.54 569.725,1042.4 580.338,1036.33 
  590.951,1030.32 601.564,1024.38 612.178,1018.51 622.791,1012.7 633.404,1006.96 644.018,1001.28 654.631,995.666 665.244,990.115 675.857,984.627 686.471,979.202 
  697.084,973.839 707.697,968.538 718.311,963.298 728.924,958.12 739.537,953.002 750.15,947.945 760.764,942.947 771.377,938.009 781.99,933.13 792.603,928.309 
  803.217,923.547 813.83,918.842 824.443,914.195 835.057,909.605 845.67,905.071 856.283,900.594 866.896,896.172 877.51,891.805 888.123,887.494 898.736,883.237 
  909.35,879.034 919.963,874.885 930.576,870.788 941.189,866.745 951.803,862.754 962.416,858.816 973.029,854.928 983.643,851.092 994.256,847.307 1004.87,843.572 
  1015.48,839.887 1026.1,836.252 1036.71,832.666 1047.32,829.128 1057.94,825.639 1068.55,822.197 1079.16,818.803 1089.78,815.457 1100.39,812.156 1111,808.902 
  1121.62,805.694 1132.23,802.532 1142.84,799.414 1153.46,796.341 1164.07,793.312 1174.68,790.326 1185.29,787.384 1195.91,784.485 1206.52,781.629 1217.13,778.815 
  1227.75,776.042 1238.36,773.311 1248.97,770.62 1259.59,767.97 1270.2,765.36 1280.81,762.79 1291.43,760.258 1302.04,757.766 1312.65,755.312 1323.27,752.896 
  1333.88,750.518 1344.49,748.176 1355.11,745.872 1365.72,743.603 1376.33,741.371 1386.95,739.174 1397.56,737.013 1408.17,734.886 1418.79,732.793 1429.4,730.734 
  1440.01,728.708 1450.63,726.716 1461.24,724.756 1471.85,722.828 1482.47,720.932 1493.08,719.068 1503.69,717.234 1514.31,715.431 1524.92,713.658 1535.53,711.915 
  1546.15,710.201 1556.76,708.516 1567.37,706.86 1577.99,705.232 1588.6,703.631 1599.21,702.057 1609.83,700.511 1620.44,698.99 1631.05,697.496 1641.67,696.028 
  1652.28,694.584 1662.89,693.165 1673.51,691.771 1684.12,690.401 1694.73,689.054 1705.35,687.73 1715.96,686.429 1726.57,685.15 1737.19,683.893 1747.8,682.658 
  1758.41,681.443 1769.03,680.25 1779.64,679.076 1790.25,677.923 1800.87,676.788 1811.48,675.673 1822.09,674.576 1832.71,673.498 1843.32,672.437 1853.93,671.393 
  1864.54,670.367 1875.16,669.357 1885.77,668.363 1896.38,667.385 1907,666.422 1917.61,665.474 1928.22,664.54 1938.84,663.62 1949.45,662.714 1960.06,661.821 
  1970.68,660.941 1981.29,660.074 1991.9,659.218 2002.52,658.374 2013.13,657.541 2023.74,656.719 2034.36,655.907 2044.97,655.105 2055.58,654.312 2066.2,653.529 
  2076.81,652.754 2087.42,651.988 2098.04,651.229 2108.65,650.478 2119.26,649.734 2129.88,648.996 2140.49,648.265 2151.1,647.539 2161.72,646.819 2172.33,646.104 
  2182.94,645.393 2193.56,644.686 2204.17,643.983 2214.78,643.284 2225.4,642.587 2236.01,641.893 2246.62,641.201 2257.24,640.51 2267.85,639.821 2278.46,639.132 
  2289.08,638.444 
  "/>
<path clip-path="url(#clip030)" d="
M177.741 251.365 L565.496 251.365 L565.496 95.8446 L177.741 95.8446  Z
  " fill="#eaeaea" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip030)" style="stroke:#ffffff; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  177.741,251.365 565.496,251.365 565.496,95.8446 177.741,95.8446 177.741,251.365 
  "/>
<polyline clip-path="url(#clip030)" style="stroke:#007f7f; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  202.741,147.685 352.742,147.685 
  "/>
<path clip-path="url(#clip030)" d="M393.575 135.011 L387.233 152.21 L399.941 152.21 L393.575 135.011 M390.936 130.405 L396.237 130.405 L409.409 164.965 L404.547 164.965 L401.399 156.099 L385.821 156.099 L382.673 164.965 L377.742 164.965 L390.936 130.405 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M429.293 143.02 Q428.575 142.604 427.719 142.418 Q426.885 142.21 425.867 142.21 Q422.256 142.21 420.311 144.571 Q418.39 146.909 418.39 151.307 L418.39 164.965 L414.108 164.965 L414.108 139.039 L418.39 139.039 L418.39 143.067 Q419.733 140.705 421.885 139.571 Q424.038 138.414 427.117 138.414 Q427.557 138.414 428.089 138.483 Q428.621 138.53 429.27 138.645 L429.293 143.02 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M453.112 144.016 Q454.709 141.145 456.931 139.78 Q459.154 138.414 462.163 138.414 Q466.214 138.414 468.413 141.261 Q470.612 144.085 470.612 149.317 L470.612 164.965 L466.33 164.965 L466.33 149.455 Q466.33 145.729 465.01 143.923 Q463.691 142.118 460.982 142.118 Q457.672 142.118 455.751 144.317 Q453.83 146.516 453.83 150.312 L453.83 164.965 L449.547 164.965 L449.547 149.455 Q449.547 145.705 448.228 143.923 Q446.908 142.118 444.154 142.118 Q440.89 142.118 438.969 144.34 Q437.047 146.539 437.047 150.312 L437.047 164.965 L432.765 164.965 L432.765 139.039 L437.047 139.039 L437.047 143.067 Q438.506 140.682 440.543 139.548 Q442.58 138.414 445.381 138.414 Q448.205 138.414 450.172 139.849 Q452.163 141.284 453.112 144.016 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M495.589 161.029 L503.228 161.029 L503.228 134.664 L494.917 136.331 L494.917 132.071 L503.181 130.405 L507.857 130.405 L507.857 161.029 L515.496 161.029 L515.496 164.965 L495.589 164.965 L495.589 161.029 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip030)" style="stroke:#fe005d; stroke-linecap:butt; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  202.741,199.525 352.742,199.525 
  "/>
<path clip-path="url(#clip030)" d="M393.575 186.851 L387.233 204.05 L399.941 204.05 L393.575 186.851 M390.936 182.245 L396.237 182.245 L409.409 216.805 L404.547 216.805 L401.399 207.939 L385.821 207.939 L382.673 216.805 L377.742 216.805 L390.936 182.245 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M429.293 194.86 Q428.575 194.444 427.719 194.258 Q426.885 194.05 425.867 194.05 Q422.256 194.05 420.311 196.411 Q418.39 198.749 418.39 203.147 L418.39 216.805 L414.108 216.805 L414.108 190.879 L418.39 190.879 L418.39 194.907 Q419.733 192.545 421.885 191.411 Q424.038 190.254 427.117 190.254 Q427.557 190.254 428.089 190.323 Q428.621 190.37 429.27 190.485 L429.293 194.86 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M453.112 195.856 Q454.709 192.985 456.931 191.62 Q459.154 190.254 462.163 190.254 Q466.214 190.254 468.413 193.101 Q470.612 195.925 470.612 201.157 L470.612 216.805 L466.33 216.805 L466.33 201.295 Q466.33 197.569 465.01 195.763 Q463.691 193.958 460.982 193.958 Q457.672 193.958 455.751 196.157 Q453.83 198.356 453.83 202.152 L453.83 216.805 L449.547 216.805 L449.547 201.295 Q449.547 197.545 448.228 195.763 Q446.908 193.958 444.154 193.958 Q440.89 193.958 438.969 196.18 Q437.047 198.379 437.047 202.152 L437.047 216.805 L432.765 216.805 L432.765 190.879 L437.047 190.879 L437.047 194.907 Q438.506 192.522 440.543 191.388 Q442.58 190.254 445.381 190.254 Q448.205 190.254 450.172 191.689 Q452.163 193.124 453.112 195.856 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip030)" d="M498.806 212.869 L515.126 212.869 L515.126 216.805 L493.181 216.805 L493.181 212.869 Q495.843 210.115 500.427 205.485 Q505.033 200.832 506.214 199.49 Q508.459 196.967 509.339 195.231 Q510.241 193.471 510.241 191.782 Q510.241 189.027 508.297 187.291 Q506.376 185.555 503.274 185.555 Q501.075 185.555 498.621 186.319 Q496.191 187.083 493.413 188.633 L493.413 183.911 Q496.237 182.777 498.691 182.198 Q501.144 181.62 503.181 181.62 Q508.552 181.62 511.746 184.305 Q514.94 186.99 514.94 191.481 Q514.94 193.61 514.13 195.532 Q513.343 197.43 511.237 200.022 Q510.658 200.694 507.556 203.911 Q504.454 207.106 498.806 212.869 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /></svg>
<p>This is a difficult problem as the reward function for the teal arm is far smoother on the left side of the space than the right. This can confuse the agent into believing the function is smoother than it is.</p><pre><code class="language- hljs">num_arms = length(mf)
csampler = UniformContexts(limits)
rsampler = GaussianRewards(mf)

batch_size = 10 # Update linear model after ever 10 steps
inital_batches = 1 # Initialise models after 1 batch
retrain = [10 * i for i in 1:10000] # Retrain partition after every 10 batches
policy = PolynomialThompsonSampling(
    limits, 
    num_arms, 
    inital_batches, 
    retrain;
    λ=20.0, # Increase prior scaling for complex functions
    α=20.0, # Increase exploration for difficult problem
    tol=1e-3, # Regulate complexity of partition
)
metrics = (FunctionalRegret(mf),)
driver = StandardDriver(csampler, policy, rsampler, metrics)

# The details of the below function are not relevant. This simply computes the standard
# deviation of the Thompson samples. This is used to visualize the &quot;confidence&quot; the agent
# has in an action&#39;s optimality.
function thompson_std(pol::PolynomialThompsonSampling, X::AbstractMatrix{Float64}, a::Int64)
    n = size(X, 2)
    σ = zeros(n)

    for i in 1:n
        shape, scale = NonlinearBandits.shape_scale(pol.arms[a])
        x = X[:, i:i]
        k = locate(pol.arms[a].P, x)[1]
        varmean = scale / (shape - 1)
        Σ = pol.α * varmean * pol.arms[a].models[k].lm.Σ
        z = expand(
            x,
            pol.arms[a].models[k].basis,
            pol.arms[a].P.regions[k];
            J=pol.arms[a].models[k].J,
        )
        σ[i] = (z&#39; * Σ * z)[1, 1] |&gt; sqrt
    end
    return σ
end

view_batches = [1, 10, 20, 50, 1000]
Xplt = reshape(xplt, (1, :))

plt_vec = []
for s in view_batches
    run!(s - policy.batches, batch_size, driver, verbose=false)
    plt = plot(legend=nothing, title=&quot;Batches: $s, Time: $(policy.t)&quot;)
    for a in 1:length(mf)
        plot!(plt, xplt, mf[a], color=cls[a])
        yplt = policy.arms[a](Xplt)
        std = thompson_std(policy, Xplt, a)
        plot!(xplt, yplt[1, :], color=cls[a], ribbon= 2 * std, ls=:dash, fillalpha=0.2)
        Xa, ra = arm_data(policy.data, a)
        plot!(Xa, ra, alpha=0.2, st=:scatter, color=cls[a])
    end
    push!(plt_vec, plt)
end
plot(plt_vec..., size=(700, length(view_batches) * 600), layout=(length(view_batches), 1))</code></pre><p>From these plots we can see how the agent trials different actions across the space, then eventually learns to choose the optimal actions depending on the context. This is evident from the total regret:</p><pre><code class="language- hljs">total_regret = metrics[1].regret |&gt; cumsum
plot(total_regret, ylab=&quot;Total regret&quot;, xlab=&quot;t&quot;, legend=nothing)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Introduction</a><a class="docs-footer-nextpage" href="../bandits_api/">Bandits »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.15 on <span class="colophon-date" title="Monday 21 March 2022 13:56">Monday 21 March 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
